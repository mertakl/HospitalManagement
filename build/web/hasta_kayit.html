<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Hasta</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet"
              href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css">
        <script
        src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script
        src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"></script>
        <script
        src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

        <style>
            .container-fluid {
                margin-top: 100px;
                width: 1000px;
                margin-bottom: 100px;
            }

            #yhastadiv {
                display: none;
            }
            .footer {
                position: fixed;
                left: 0;
                bottom: 0;
                width: 100%;
                height: 60px;
                background-color: #f2f2f2;
                color: black;
                text-align: center;
            }
            #tcKimlik{
                 max-height: 100px;
            }
        </style>
    </head>
    <body>
        <nav class="navbar fixed-top navbar-expand-sm bg-primary navbar-dark">
            <ul class="navbar-nav">
                <li class="nav-item"><a class="nav-link"
                                        href="/RestProject/index.html"><i class="fa fa-home fa-fw"></i> Ana Sayfa</a></li>
                <li class="nav-item active"><a class="nav-link"
                                               href="/RestProject/hasta_kayit.html"><i class="fa fa-save"></i> Hasta Kaydı</a></li>                               
                <li class="nav-item"><a class="nav-link"
                                        href="/RestProject/randevu.html"><i class="fa fa-clock-o"></i> Randevu Ver</a></li>
                <li class="nav-item"><a class="nav-link"
                                        href="/RestProject/muayene_kayit.html"><i class="fa fa-ambulance"></i> Muayene Kayıt</a></li>
                </li>
                <li class="nav-item"><a class="nav-link"
                                        href="/RestProject/muayene_bilgi.html"><i class="fa fa-hospital-o"></i> Muayenehane Bilgileri</a></li>
                <li class="nav-item"><a class="nav-link"
                                               href="/RestProject/hesapyonet.html"><i class="fa fa-user"></i> Hesabı Yönet</a></li>                        
                <!-- Dropdown -->
                <li class="nav-item dropdown"><a
                        class="nav-link dropdown-toggle" href="#" id="navbardrop"
                        data-toggle="dropdown">Listele</a>
                    <div class="dropdown-menu">
                        <a class="dropdown-item" href="/RestProject/hastagoster.html">Hastaları
                            Listele</a> <a class="dropdown-item"
                                       href="/RestProject/randevugoster.html">Randevuları Listele</a> <a
                                       class="dropdown-item" href="/RestProject/muayenegoster.html">Muayeneleri
                            Listele</a>
                    </div></li>
            </ul>
            <ul class="navbar-nav ml-auto">
                <li class="nav-item"><a class="nav-link" href="#" id="getKullanici"></a></li>
                <li class="nav-item"><a class="nav-link" href="#"
                                        onclick="logout()"><i class="fa fa-sign-out"></i> Çıkış Yap</a></li>
            </ul>
        </nav>
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-6">
                    <form action="Rest/hastaService/insertHasta" method="post"
                          name="myForm">
                        <div class="form-group row">
                            <label for="tcKimlik" class="col-4 col-form-label">Tc
                                Kimlik:</label>
                            <div class="col-10">
                                <input class="form-control" type="number" id="tcKimlik"
                                       name="tcKimlik" size="11" maxlength="11">
                            </div>
                        </div>
                        <div class="checkbox">
                            <label><input type="checkbox" value = "checked" id="yhasta" name="yhasta">Yabancı
                                Hasta</label>
                        </div>
                        <div class="form-group row" id="yhastadiv">
                            <label for="ulke" class="col-4 col-form-label">Ülke Seçin:</label>
                            <div class="col-10">
                                <select class="form-control" name="ulke" id="ulke">
                                    <option></option>
                                </select>
                            </div>
                            <label for="pasaportNo" class="col-4 col-form-label">Pasaport
                                No:</label>
                            <div class="col-10">
                                <input class="form-control" type="text" id="pasaportNo"
                                       name="pasaportNo">
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="isim" class="col-4 col-form-label">İsim:</label>
                            <div class="col-10">
                                <input class="form-control" type="text" name="isim" id="isim">
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="soyisim" class="col-4 col-form-label">Soyisim:</label>
                            <div class="col-10">
                                <input class="form-control" type="text" name="soyisim" id="soyisim">
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="dogum" class="col-4 col-form-label">Doğum Tarih:</label>
                            <div class="form-group">
                                <input class="form-control" type="date" name="dogum" id="dogum">
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="cinsiyet" class="col-4 col-form-label">Cinsiyet:</label>
                            <div class="form-group">
                                <select class="form-control" name="cinsiyet" id="cinsiyet">
                                    <option value="Erkek">Erkek</option>
                                    <option value="Kadın">Kadın</option>
                                </select>
                            </div>
                        </div>
                </div>
                <div class="col-sm-6">
                    <div class="form-group row">
                        <label for="babaAdi" class="col-4 col-form-label">Baba Adı:</label>
                        <div class="col-10">
                            <input class="form-control" type="text" name="babaAdi" id="babaAdi">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="medeniHal" class="col-4 col-form-label">Medeni Hal:</label>
                        <div class="form-group">
                            <select class="form-control" name="medeniHal" id="medeniHal">
                                <option value="Evli">Evli</option>
                                <option value="Bekar">Bekar</option>
                                <option value="Dul">Dul</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="tel_no" class="col-4 col-form-label">Telefon</label>
                        <div class="col-10">
                            <input class="form-control" type="text" name="tel_no" id="tel_no">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="email" class="col-4 col-form-label">Email</label>
                        <div class="col-10">
                            <input class="form-control" type="email" name="email" id="email">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="meslek" class="col-4 col-form-label">Meslek</label>
                        <div class="col-10">
                            <input class="form-control" type="text" name="meslek" id="meslek">
                        </div>
                    </div>
                    <input type="button" onclick="return submitForm(this.form)"
                           class="btn btn-primary" value="Kaydet" />
                    </form>
                </div>
            </div>
        </div>
        <script type="text/javascript">

            $(document).ready(function () {

                $('#tcKimlik').keyup((e) => {

                    var searchKey = e.currentTarget.value;

                    if (searchKey.length < 11)
                        return;

                    var theUrl = "http://localhost:8080/RestProject/Rest/hastaService/searchTcKimlik/" + searchKey;

                    var xmlHttp = new XMLHttpRequest();
                    xmlHttp.onreadystatechange = function () {
                        if (xmlHttp.readyState == 4 && xmlHttp.status == 200) {
                            var myArr = JSON.parse(xmlHttp.responseText);
                            for (var i = 0; i < myArr.length; i++) {

                                document.getElementById('isim').value = myArr[i].isim;

                                document.getElementById('tcKimlik').value = myArr[i].tcKimlik;

                                document.getElementById('soyisim').value = myArr[i].soyIsim;

                            }

                        }
                    };
                    xmlHttp.open("GET", theUrl, true); // true for asynchronous 
                    xmlHttp.send(null);

                });
            });

            $('#yhasta').change(function () {
                $('#yhastadiv').toggle();
            });

            $("#yhasta").change(function () {
                if (this.checked) {
                    document.getElementById("tcKimlik").disabled = true;
                } else {
                    document.getElementById("tcKimlik").disabled = false;
                }
            });


            function submitForm(form) {

                var randomTc = Math.floor(Math.pow(10, 11 - 1) + Math.random() * (Math.pow(10, 11) - Math.pow(10, 11 - 1) - 1));


                if ($('#tcKimlik').val().length == 0 && $('#yhasta:checked').val() == 'checked') {

                    document.getElementById('tcKimlik').value = randomTc;

                } else if ($('#tcKimlik').val().length < 11) {

                    alert("Tc Kimlik Hatalı Girildi!");
                    return;

                }

                var url = form.getAttribute("action");
                var formData = $(form).serializeArray();
                $.post(url, formData)
                        .done(function (data) {
                            alert(data);

                            document.getElementById('tcKimlik').value = "";

                            document.getElementById('isim').value = "";

                            document.getElementById('soyisim').value = "";

                            document.getElementById('pasaportNo').value = "";

                            document.getElementById('ulke').value = "<option></option>";

                            document.getElementById('dogum').value = "";

                            document.getElementById('tel_no').value = "";

                            document.getElementById('email').value = "";

                            document.getElementById('meslek').value = "";

                            document.getElementById('babaAdi').value = "";

                        })
                        .fail(function (xhr, status, error) {
                            alert(xhr.responseText);
                        });
            }


            //Kullanıcı İsmini Getir
            $(document).ready(function () {

                var theUrl = "http://localhost:8080/RestProject/Rest/hastaService/getKullanici";
                var xmlHttp = new XMLHttpRequest();
                xmlHttp.onreadystatechange = function () {
                    if (xmlHttp.readyState == 4 && xmlHttp.status == 200) {
                        document.getElementById("getKullanici").innerHTML = xmlHttp.responseText;
                    }
                };
                xmlHttp.open("POST", theUrl, true); // true for asynchronous 
                xmlHttp.send(null);

            });


            //Kullanıcı Çıkış Yap
            function logout() {
                var theUrl = "http://localhost:8080/RestProject/Rest/hastaService/logout";
                var xmlHttp = new XMLHttpRequest();
                xmlHttp.onreadystatechange = function () {
                    if (xmlHttp.readyState == 4 && xmlHttp.status == 200) {
                        window.location.href = "http://localhost:8080/RestProject";
                    }
                };
                xmlHttp.open("POST", theUrl, true); // true for asynchronous 
                xmlHttp.send(null);
            }
            ;

            var xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {

                    var myArr = JSON.parse(this.responseText);

                    for (var i = 0; i < myArr.length; i++) {

                        var div_data = "<option value=" + myArr[i].ulke + ">"
                                + myArr[i].ulke + "</option>";

                        $(div_data).appendTo('#ulke');
                    }

                }

            };
            xmlhttp.open("POST",
                    "http://localhost:8080/RestProject/Rest/hastaService/ulkeler",
                    true);
            xmlhttp.send();

        </script>
        <footer class="footer">
            <i class="fa fa-copyright"></i><p>Tüm Hakları Saklıdır</p>
        </footer>
    </body>
</html>